<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <title>ì˜í™” ë¦¬ë·° ìƒì„¸ë³´ê¸°</title>
    <link rel="stylesheet" th:href="@{/style.css}" />
</head>
<body>
<div id="navbar" th:replace="~{/navbar}"></div>

<main class="detail-container">

    <div class="detail-left">
        <div class="detail-photo-box">
            <img alt="ì˜í™” í¬ìŠ¤í„°"
                 th:src="${review.posterPath != null} ? ${review.posterPath} : 'https://via.placeholder.com/220x260.png?text=í¬ìŠ¤í„°'" />
        </div>
        <p class="detail-date" th:text="${review.watchedDate}"></p>
    </div>

    <div class="detail-right">
        <div class="info-row">
            <div class="detail-title" th:text="${review.title}">ì•„ì§ ì œëª© ì—†ìŒ</div>
            <div class="detail-rating">ğŸŠğŸŠğŸŠğŸŠğŸŠ</div>
        </div>

        <div class="detail-review" th:text="${review.content}"></div>

        <div class="btn-group">
            <a class="btn" th:href="@{/api/edit/{id}(id=${review.id})}">ìˆ˜ì •</a>
            <button class="btn" id="btn-delete">ì‚­ì œ</button>
        </div>
    </div>
</main>

<!-- review.id ë¥¼ JSì—ì„œ ì“°ê¸° ìœ„í•´ íƒ€ì„ë¦¬í”„ë¡œ ë³€ìˆ˜ ì „ë‹¬ -->
<script th:inline="javascript">
    const reviewId = [[${review.id}]];
</script>

<script>
    document.getElementById("btn-delete").addEventListener("click", async () => {
        if (!confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;

        try {
            const res = await fetch(`/api/delete/${reviewId}`, {
                method: "DELETE"
            });

            if (!res.ok) throw new Error(res.status);

            alert("ë¦¬ë·°ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤!");
            window.location.href = "/api";

        } catch (e) {
            console.error(e);
            alert("ì‚­ì œ ì‹¤íŒ¨: " + e.message);
        }
    });
</script>

</body>
</html>
