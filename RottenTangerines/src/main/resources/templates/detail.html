<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <title>ì˜í™” ë¦¬ë·° ìƒì„¸ë³´ê¸°</title>
    <link rel="stylesheet" th:href="@{/style.css}" />
</head>
<body>
<div id="navbar" th:replace="/navbar"></div>

<main class="detail-container">

    <!-- ì™¼ìª½: í¬ìŠ¤í„° + ê´€ëŒì¼ -->
    <div class="detail-left">
        <div class="detail-photo-box">
            <img src="https://via.placeholder.com/220x260.png?text=í¬ìŠ¤í„°" alt="ì˜í™” í¬ìŠ¤í„°" />
        </div>
        <p class="detail-date"></p>
    </div>

    <!-- ì˜¤ë¥¸ìª½: ì˜í™” ì •ë³´ + ìˆ˜ì •/ì‚­ì œ ë²„íŠ¼ -->
    <div class="detail-right">
        <div class="info-row">
            <span th:text="${review.title}">ì•„ì§ ì œëª© ì—†ìŒ</span>
            <span th:text="${review.watchedDate}">ë‚ ì§œ ì—†ìŒ</span>
            <!-- <input type="text" class="detail-title"  readonly /> -->
            <div class="detail-rating">ğŸŠğŸŠğŸŠğŸŠğŸŠ</div>
        </div>
        <textarea class="detail-review" readonly>
        </textarea>

        <div class="btn-group">
            <button class="btn">ìˆ˜ì •</button>
            <button class="btn">ì‚­ì œ</button>
        </div>
    </div>
</main>

<script>
    <!--// URLì—ì„œ id ê°€ì ¸ì˜¤ê¸°
    const params = new URLSearchParams(window.location.search);
    const id = params.get("id");

    // navbar ë¶ˆëŸ¬ì˜¤ê¸°
    fetch("navbar.html")
      .then(res => res.text())
      .then(html => {
        document.getElementById("navbar").innerHTML = html;
        document.getElementById("homeBtn").addEventListener("click", () => {
          window.location.href = "home.html";
        });
        document.getElementById("newBtn").addEventListener("click", () => {
          window.location.href = "new.html";
        });
      });

    // ë°±ì—”ë“œì—ì„œ ë¦¬ë·° ì •ë³´ ê°€ì ¸ì˜¤ê¸°
    fetch(`/api/reviews/${id}`)
      .then(res => res.json())
      .then(review => {
        document.querySelector(".detail-title").value = review.title;
        document.querySelector(".detail-review").value = review.content;
        document.querySelector(".detail-date").textContent = review.watchedDate;
        document.querySelector(".detail-photo-box img").src = review.posterPath || "https://via.placeholder.com/220x260.png?text=í¬ìŠ¤í„°";

        // í‰ì  í‘œì‹œ
        const ratingBox = document.querySelector(".detail-rating");
        const rating = Number(review.rating) || 0;
        ratingBox.innerHTML = "ğŸŠ".repeat(rating) + "ğŸŠ".repeat(5 - rating).replace(/ğŸŠ/g, '<span class="orange unselected">ğŸŠ</span>');
      })
      .catch(err => console.error("ë¦¬ë·° ë¡œë“œ ì˜¤ë¥˜:", err));

    // ìˆ˜ì • ë²„íŠ¼ â†’ edit.htmlë¡œ ì´ë™
    document.getElementById("editBtn").addEventListener("click", () => {
      window.location.href = `edit.html?id=${id}`;
    });

    // ì‚­ì œ ë²„íŠ¼ â†’ DELETE ìš”ì²­
    document.getElementById("deleteBtn").addEventListener("click", () => {
      if(confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")){
        fetch(`/api/delete/${id}`, { method: "DELETE" })
          .then(res => {
            if(res.ok){
              alert("ì‚­ì œ ì™„ë£Œ! í™ˆìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.");
              window.location.href = "home.html";
            } else {
              alert("ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
            }
          })
          .catch(err => {
            console.error(err);
            alert("ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
          });
      }
    });-->
</script>
</body>
</html>
