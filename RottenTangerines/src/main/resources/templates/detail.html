<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <title>ì˜í™” ë¦¬ë·° ìƒì„¸ë³´ê¸°</title>
    <link rel="stylesheet" th:href="@{/style.css}" />
</head>
<body>
<div id="navbar" th:replace="/navbar"></div>

<main class="detail-container">

    <!-- ì™¼ìª½: í¬ìŠ¤í„° + ê´€ëŒì¼ -->
    <div class="detail-left">
        <div class="detail-photo-box">
            <img src="https://via.placeholder.com/220x260.png?text=í¬ìŠ¤í„°" alt="ì˜í™” í¬ìŠ¤í„°" />
        </div>
        <p class="detail-date" th:text="${review.watchedDate}">></p>

    </div>

    <!-- ì˜¤ë¥¸ìª½: ì˜í™” ì •ë³´ + ìˆ˜ì •/ì‚­ì œ ë²„íŠ¼ -->
    <div class="detail-right">
        <div class="info-row">
            <div type="text" class="detail-title" th:text="${review.title}">ì•„ì§ ì œëª© ì—†ìŒ</div>
            <div class="detail-rating">ğŸŠğŸŠğŸŠğŸŠğŸŠ</div>
        </div>
        <textarea class="detail-review" th:text="${review.content}">ì•„ì§ ë‚´ìš© ì—†ìŒ>
        </textarea>

        <div class="btn-group">
            <button class="btn" id="btn-save">ìˆ˜ì •</button>
            <button class="btn" >ì‚­ì œ</button>
        </div>
    </div>
</main>

<script>
    $("#btn-save").addEventListener("click", async () => {
  const formData = new FormData();
  formData.append("title", $("#title").value);
  formData.append("watchedDate", $("#watchedDate").value);
  formData.append("content", $("#content").value);
  formData.append("rating", $("#rating").value);

  const file = $("#posterPath").files[0];
  if (file) {
    formData.append("posterPath", file);
  }

  try {
    const res = await fetch("/reviews/image", {
      method: "POST",
      body: formData
    });

    if (!res.ok) throw new Error(res.status);

    const data = await res.json();

    // ğŸ”¥ ì €ì¥ ì„±ê³µí–ˆìœ¼ë‹ˆê¹Œ í˜ì´ì§€ ì´ë™!
    // ìƒì„¸ í˜ì´ì§€ idê°€ ìˆë‹¤ë©´:
    window.location.href = `/detail.html?id=${data.id}`;

    // ë˜ëŠ” ë¦¬ìŠ¤íŠ¸ í˜ì´ì§€ë¡œ ì´ë™í•˜ê³  ì‹¶ìœ¼ë©´:
    // window.location.href = "/index.html";

  } catch (e) {
    console.error(e);
    alert("ì—…ë¡œë“œ ì‹¤íŒ¨: " + e.message);
  }
});
</script>
</body>
</html>
