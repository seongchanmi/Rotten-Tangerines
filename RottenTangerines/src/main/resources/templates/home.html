<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <title>Rotten Tangerines</title>
    <link rel="stylesheet" th:href="@{/style.css}" />
    <style>
        .movie-card {
  border: 2px solid #ffd18b; /* í…Œë‘ë¦¬ ìƒ‰ìƒ (ì˜ˆ: ê·¤ìƒ‰ ê³„ì—´) */
  border-radius: 12px; /* ëª¨ì„œë¦¬ ë‘¥ê¸€ê²Œ */
  padding: 8px; /* ì•ˆìª½ ì—¬ë°± */
  background-color: #fffaf2; /* ì¹´ë“œ ë°°ê²½ìƒ‰ (ì‚´ì§ ë”°ëœ»í•œ í°ìƒ‰ ëŠë‚Œ) */
  transition: transform 0.2s ease, box-shadow 0.2s ease; /* ì• ë‹ˆë©”ì´ì…˜ */
}

.movie-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 4px 12px rgba(255, 180, 0, 0.3); /* í˜¸ë²„ ì‹œ ì‚´ì§ ë– ì˜¤ë¥´ê²Œ */
}
    </style>
</head>
<body>
<!-- ê³µí†µ ë„¤ë¹„ê²Œì´ì…˜ -->
<div id="navbar" th:replace="/navbar"></div>

<!--ì˜í™” ì¹´ë“œê°€ JSì—ì„œ ë™ì ìœ¼ë¡œ ìƒì„±-->
<main class="grid" id="movieGrid"></main>

<script>
    const $ = (selector) => document.querySelector(selector);
    const movieGrid = $('#movieGrid');

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì˜í™” ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
    async function loadMovies() {
        try {
            const res = await fetch('/api/home');
            if (!res.ok) throw new Error('ì˜í™” ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');

            const movies = await res.json();

            // ì˜í™”ê°€ ì—†ì„ ë•Œ
            if (movies.length === 0) {
                movieGrid.innerHTML = '<p style="text-align: center; color: #999; margin-top: 50px;">ì•„ì§ ë“±ë¡ëœ ë¦¬ë·°ê°€ ì—†ìŠµë‹ˆë‹¤ ğŸŠ</p>';
                return;
            }

            // ì˜í™” ì¹´ë“œ ìƒì„±
            movieGrid.innerHTML = movies.map(movie => createMovieCard(movie)).join('');

            // ì¹´ë“œ í´ë¦­ ì´ë²¤íŠ¸ ë“±ë¡
            document.querySelectorAll('.movie-card').forEach(card => {
                card.addEventListener('click', () => {
                    const id = card.dataset.id;
                    window.location.href = `/api/detail/${id}`;  // ìƒì„¸ í˜ì´ì§€ë¡œ ì´ë™
                });
            });

        } catch (e) {
            console.error(e);
            movieGrid.innerHTML = '<p style="text-align: center; color: red;">ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>';
        }
    }

    // ì˜í™” ì¹´ë“œ HTML ìƒì„± í•¨ìˆ˜
    function createMovieCard(movie) {
        // ê·¤ í‰ì  ìƒì„±
        const oranges = 'ğŸŠ'.repeat(movie.rating);
        const emptyOranges = 'ğŸŠ'.repeat(5 - movie.rating);

        return `
            <div class="movie-card" data-id="${movie.id}" style="cursor: pointer;">
                <div class="movie-poster">
                    <img src="${movie.posterPath || 'https://via.placeholder.com/220x260.png?text=í¬ìŠ¤í„°'}"
                         alt="${movie.title}"
                         style="width: 100%; height: 100%; object-fit: cover;" />
                </div>
                <div class="movie-info">
                    <h3 class="movie-title">${movie.title}</h3>
                    <div class="movie-rating" style="filter: drop-shadow(0 0 8px rgba(255, 165, 0, 0.5));">
                        <span style="filter: grayscale(0%);">${oranges}</span><span style="filter: grayscale(100%) brightness(0.8);">${emptyOranges}</span>
                    </div>
                    <p class="movie-date">${movie.watchedDate}</p>
                </div>
            </div>
        `;
    }

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰
    loadMovies();
</script>
</body>
</html>








